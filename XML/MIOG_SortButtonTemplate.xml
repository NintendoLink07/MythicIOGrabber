<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/ui/
..\..\FrameXML\UI.xsd">
    <Button name="MIOG_SortButtonTemplate" inherits="MIOG_MultiStateButtonTemplate" virtual="true">
        <Layers>
            <Layer level="OVERLAY">
                <FontString parentKey="FontString" font="LibMono" justifyH="CENTER">
                    <Anchors>
                        <Anchor point="BOTTOMLEFT" relativeKey="$parent" relativePoint="BOTTOMLEFT"/>
                    </Anchors>
                </FontString>
            </Layer>
        </Layers>

        <Scripts>
            <OnClick>
                local activeState = self:GetActiveState()
                local panelString = "sortMethods_" .. self.panel

                if(button == "LeftButton") then

                    if(activeState == 0 and 2 > MIOG_SavedSettings[panelString].table.numberOfActiveMethods) then
                        --TO 1
                        MIOG_SavedSettings[panelString].table.numberOfActiveMethods = MIOG_SavedSettings[panelString].table.numberOfActiveMethods + 1

                        MIOG_SavedSettings[panelString].table[self.category].active = true
                        MIOG_SavedSettings[panelString].table[self.category].currentLayer = MIOG_SavedSettings[panelString].table.numberOfActiveMethods

                        self.FontString:SetText(MIOG_SavedSettings[panelString].table.numberOfActiveMethods)

                    elseif(activeState == 1) then
                        --TO 2


                    elseif(activeState == 2) then
                        --RESET TO 0
                        MIOG_SavedSettings[panelString].table.numberOfActiveMethods = MIOG_SavedSettings[panelString].table.numberOfActiveMethods - 1

                        MIOG_SavedSettings[panelString].table[self.category].active = false
                        MIOG_SavedSettings[panelString].table[self.category].currentLayer = 0

                        self.FontString:SetText("")

                        for k, v in pairs(MIOG_SavedSettings[panelString].table) do
                            if(type(v) == "table" and v.currentLayer == 2) then
                                v.currentLayer = 1
                                self:GetParent().sortByCategoryButtons[k].FontString:SetText(1)
                                MIOG_SavedSettings[panelString].table[k].currentLayer = 1
                            end
                        end
                    end

                    if(2 > MIOG_SavedSettings[panelString].table.numberOfActiveMethods or MIOG_SavedSettings[panelString].table.numberOfActiveMethods == 2 and MIOG_SavedSettings[panelString].table[self.category].active == true) then
                        self:AdvanceState()

                        MIOG_SavedSettings[panelString].table[self.category].currentState = self:GetActiveState()

                        if(GameTooltip:GetOwner() == self) then
                            GameTooltip:SetText("Current sort: "..self:GetStateName(self:GetActiveState()))
                        end
                    end

                elseif(button == "RightButton") then
                    if(activeState == 1 or activeState == 2) then

                        MIOG_SavedSettings[panelString].table.numberOfActiveMethods = MIOG_SavedSettings[panelString].table.numberOfActiveMethods - 1

                        MIOG_SavedSettings[panelString].table[self.category].active = false
                        MIOG_SavedSettings[panelString].table[self.category].currentLayer = 0

                        self.FontString:SetText("")

                        for k, v in pairs(MIOG_SavedSettings[panelString].table) do
                            if(type(v) == "table" and v.currentLayer == 2) then
                                v.currentLayer = 1
                                self:GetParent().sortByCategoryButtons[k].FontString:SetText(1)
                                MIOG_SavedSettings[panelString].table[k].currentLayer = 1
                            end
                        end

                        self:SetState(false)

                        if(2 > MIOG_SavedSettings[panelString].table.numberOfActiveMethods or MIOG_SavedSettings[panelString].table.numberOfActiveMethods == 2 and MIOG_SavedSettings[panelString].table[self.category].active == true) then

                            --miog.F.SORT_METHODS[currentCategory].currentState = sortByCategoryButton:GetActiveState()
                            --MIOG_SavedSettings.lastActiveSortingMethods.value[currentCategory] = miog.F.SORT_METHODS[currentCategory]

                            MIOG_SavedSettings[panelString].table[self.category].currentState = self:GetActiveState()

                            if(GameTooltip:GetOwner() == self) then
                                GameTooltip:SetText("Current sort: "..self:GetStateName(self:GetActiveState()))
                            end
                        end
                    end
                end
            </OnClick>
            <OnEnter>
                GameTooltip:SetOwner(self, "ANCHOR_RIGHT")
                GameTooltip:SetText("Current sort: "..self:GetStateName(self:GetActiveState()))
                GameTooltip:Show()
            </OnEnter>
            <OnLeave>
                GameTooltip:Hide()
            </OnLeave>
        </Scripts>
    </Button>
</Ui>